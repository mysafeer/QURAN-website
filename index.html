<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>القرآن الكريم - The Noble Quran</title>
    <link href="https://fonts.googleapis.com/css2?family=Amiri&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            /* Default Green Theme */
            --primary: #1a5f2a;
            --primary-light: #2e8b47;
            --secondary: #d4af37;
            --accent: #8b0000;
            --bg-light: #f5f7f2;
            --bg-dark: #0d1f0f;
            --text-light: #2d3748;
            --text-dark: #e2f0e4;
            --card-light: #ffffff;
            --card-dark: #152715;
            --border-light: #d1e7d1;
            --border-dark: #2a4a2a;
            --success: #28a745;
            --danger: #dc3545;
            --info: #17a2b8;
            --warning: #ffc107;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            --shadow-lg: 0 10px 25px rgba(0, 0, 0, 0.12);
            --radius: 12px;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Red Theme */
        body.theme-red {
            --primary: #8b0000;
            --primary-light: #b22222;
            --secondary: #d4af37;
            --accent: #1a5f2a;
            --bg-light: #fff5f5;
            --bg-dark: #1a0a0a;
            --text-light: #4a1c1c;
            --text-dark: #ffeaea;
            --card-light: #ffffff;
            --card-dark: #2a0f0f;
            --border-light: #f0c8c8;
            --border-dark: #4a1c1c;
        }

        /* Black/Gold Theme */
        body.theme-black {
            --primary: #000000;
            --primary-light: #333333;
            --secondary: #d4af37;
            --accent: #8b0000;
            --bg-light: #f0f0f0;
            --bg-dark: #121212;
            --text-light: #333333;
            --text-dark: #e0e0e0;
            --card-light: #ffffff;
            --card-dark: #1a1a1a;
            --border-light: #e0e0e0;
            --border-dark: #333333;
        }

        /* Blue Theme */
        body.theme-blue {
            --primary: #1e40af;
            --primary-light: #3b82f6;
            --secondary: #d97706;
            --accent: #059669;
            --bg-light: #f0f9ff;
            --bg-dark: #0c1a2d;
            --text-light: #1e3a8a;
            --text-dark: #dbeafe;
            --card-light: #ffffff;
            --card-dark: #1e293b;
            --border-light: #bfdbfe;
            --border-dark: #334155;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            transition: var(--transition);
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg-light);
            color: var(--text-light);
            display: flex;
            height: 100vh;
            overflow: hidden;
            position: relative;
        }

        /* Background Pattern */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M11 18c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm48 25c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm-43-7c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm63 31c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM34 90c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm56-76c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM12 86c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm28-65c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm23-11c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-6 60c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm29 22c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zM32 63c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm57-13c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-9-21c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM60 91c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM35 41c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM12 60c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2z' fill='%23d4af37' fill-opacity='0.03' fill-rule='evenodd'/%3E%3C/svg%3E");
            opacity: 0.5;
            z-index: -1;
        }

        /* Dark Mode */
        body.dark-mode {
            background: var(--bg-dark);
            color: var(--text-dark);
        }

        body.dark-mode::before {
            opacity: 0.1;
        }

        /* Top Navigation */
        #top-nav {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            color: white;
            padding: 15px 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 1000;
            box-shadow: var(--shadow);
            backdrop-filter: blur(10px);
            border-bottom: 2px solid var(--secondary);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo-icon {
            font-size: 28px;
            color: var(--secondary);
            animation: pulse 3s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .nav-controls {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        /* Theme Selector */
        .theme-selector {
            display: flex;
            gap: 8px;
            background: rgba(255, 255, 255, 0.1);
            padding: 6px;
            border-radius: 20px;
            backdrop-filter: blur(5px);
        }

        .theme-btn {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            border: 2px solid transparent;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .theme-btn:hover {
            transform: scale(1.1);
            border-color: white;
        }

        .theme-btn.active {
            border-color: white;
            box-shadow: 0 0 0 2px var(--secondary);
        }

        .theme-green { background: linear-gradient(135deg, #1a5f2a, #2e8b47); }
        .theme-red { background: linear-gradient(135deg, #8b0000, #b22222); }
        .theme-black { background: linear-gradient(135deg, #000000, #333333); }
        .theme-blue { background: linear-gradient(135deg, #1e40af, #3b82f6); }

        /* Sidebar */
        #sidebar {
            width: 320px;
            background: var(--card-light);
            border-right: 1px solid var(--border-light);
            overflow-y: auto;
            padding: 25px;
            margin-top: 80px;
            height: calc(100vh - 80px);
            display: flex;
            flex-direction: column;
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.05);
        }

        body.dark-mode #sidebar {
            background: var(--card-dark);
            border-right-color: var(--border-dark);
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.2);
        }

        .sidebar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--secondary);
        }

        .search-container {
            margin-bottom: 25px;
            position: relative;
        }

        #search-input {
            width: 100%;
            padding: 14px 20px 14px 45px;
            border: 2px solid var(--border-light);
            border-radius: var(--radius);
            font-size: 14px;
            background: var(--bg-light);
            color: var(--text-light);
            transition: var(--transition);
        }

        body.dark-mode #search-input {
            background: var(--bg-dark);
            border-color: var(--border-dark);
            color: var(--text-dark);
        }

        #search-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(26, 95, 42, 0.1);
            background: var(--card-light);
        }

        body.dark-mode #search-input:focus {
            background: var(--card-dark);
            box-shadow: 0 0 0 3px rgba(46, 139, 71, 0.2);
        }

        .search-icon {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--primary);
            font-size: 18px;
        }

        .surah-list-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .surah-item {
            padding: 16px;
            border-bottom: 1px solid var(--border-light);
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-radius: var(--radius);
            margin-bottom: 8px;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        body.dark-mode .surah-item {
            border-bottom-color: var(--border-dark);
        }

        .surah-item::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            width: 0;
            background: linear-gradient(90deg, transparent, rgba(212, 175, 55, 0.1), transparent);
            transition: width 0.5s ease;
        }

        .surah-item:hover::before {
            width: 100%;
        }

        .surah-item:hover {
            background: rgba(26, 95, 42, 0.05);
            transform: translateX(5px);
        }

        body.dark-mode .surah-item:hover {
            background: rgba(212, 175, 55, 0.1);
        }

        .surah-item.active {
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            color: white;
            border-left: 4px solid var(--secondary);
            box-shadow: var(--shadow);
        }

        .surah-info {
            display: flex;
            flex-direction: column;
            flex: 1;
        }

        .surah-name-arabic {
            font-family: 'Amiri', serif;
            font-size: 22px;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .surah-name-english {
            font-size: 14px;
            color: #666;
            font-weight: 500;
        }

        body.dark-mode .surah-name-english {
            color: #aaa;
        }

        .surah-item.active .surah-name-english {
            color: rgba(255, 255, 255, 0.9);
        }

        .surah-number {
            background: linear-gradient(135deg, var(--secondary), #f7d87c);
            color: #000;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 15px;
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.1);
            flex-shrink: 0;
            margin-left: 15px;
        }

        /* Main Content */
        #content {
            flex: 1;
            overflow-y: auto;
            padding: 40px;
            margin-top: 80px;
            height: calc(100vh - 80px);
            background: linear-gradient(135deg, rgba(245, 247, 242, 0.5), rgba(212, 175, 55, 0.05));
        }

        body.dark-mode #content {
            background: linear-gradient(135deg, rgba(13, 31, 15, 0.5), rgba(212, 175, 55, 0.05));
        }

        .content-header {
            margin-bottom: 35px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--secondary);
            position: relative;
        }

        .content-header::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 100px;
            height: 4px;
            background: var(--primary);
            border-radius: 2px;
        }

        .surah-title {
            font-size: 36px;
            color: var(--primary);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        body.dark-mode .surah-title {
            color: var(--text-dark);
        }

        .surah-meta {
            display: flex;
            gap: 25px;
            color: #666;
            font-size: 15px;
            flex-wrap: wrap;
        }

        body.dark-mode .surah-meta {
            color: #aaa;
        }

        .surah-meta span {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 12px;
            background: rgba(212, 175, 55, 0.1);
            border-radius: 20px;
            border: 1px solid rgba(212, 175, 55, 0.2);
        }

        /* Audio Player */
        #audio-player {
            background: linear-gradient(135deg, var(--card-light), var(--bg-light));
            padding: 20px;
            border-radius: var(--radius);
            margin-bottom: 30px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border-light);
            display: none;
        }

        body.dark-mode #audio-player {
            background: linear-gradient(135deg, var(--card-dark), var(--bg-dark));
            border-color: var(--border-dark);
        }

        #audio-player.active {
            display: block;
            animation: slideDown 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-20px) scale(0.95); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }

        .audio-controls {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .audio-info {
            flex: 1;
            font-size: 15px;
            color: var(--text-light);
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        body.dark-mode .audio-info {
            color: var(--text-dark);
        }

        .audio-progress-container {
            position: relative;
            margin-bottom: 10px;
        }

        .audio-progress {
            width: 100%;
            height: 6px;
            background: var(--border-light);
            border-radius: 3px;
            overflow: hidden;
            cursor: pointer;
        }

        body.dark-mode .audio-progress {
            background: var(--border-dark);
        }

        .audio-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--primary-light));
            width: 0%;
            transition: width 0.1s linear;
            position: relative;
        }

        .audio-progress-bar::after {
            content: '';
            position: absolute;
            right: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 12px;
            height: 12px;
            background: var(--secondary);
            border-radius: 50%;
            box-shadow: 0 0 0 3px var(--card-light);
        }

        body.dark-mode .audio-progress-bar::after {
            box-shadow: 0 0 0 3px var(--card-dark);
        }

        .audio-time {
            display: flex;
            justify-content: space-between;
            font-size: 13px;
            color: #666;
            margin-top: 5px;
        }

        body.dark-mode .audio-time {
            color: #aaa;
        }

        /* Verse Cards */
        .verse-card {
            margin-bottom: 30px;
            background: var(--card-light);
            padding: 30px;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            position: relative;
            border-left: 5px solid var(--secondary);
            transition: var(--transition);
            overflow: hidden;
        }

        .verse-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: linear-gradient(90deg, var(--primary), var(--primary-light));
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .verse-card:hover::before {
            opacity: 1;
        }

        .verse-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }

        body.dark-mode .verse-card {
            background: var(--card-dark);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
        }

        .verse-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border-light);
        }

        body.dark-mode .verse-header {
            border-bottom-color: var(--border-dark);
        }

        .verse-number {
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            color: white;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 18px;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
            position: relative;
            overflow: hidden;
        }

        .verse-number::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transform: translateX(-100%);
        }

        .verse-number:hover::before {
            animation: shine 1s;
        }

        .verse-number:hover {
            transform: scale(1.1) rotate(5deg);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
        }

        @keyframes shine {
            to { transform: translateX(100%); }
        }

        .verse-actions {
            display: flex;
            gap: 10px;
        }

        .action-btn {
            background: rgba(212, 175, 55, 0.1);
            border: 1px solid rgba(212, 175, 55, 0.2);
            color: var(--text-light);
            font-size: 18px;
            cursor: pointer;
            padding: 10px;
            border-radius: 10px;
            width: 45px;
            height: 45px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }

        body.dark-mode .action-btn {
            background: rgba(212, 175, 55, 0.15);
            border-color: rgba(212, 175, 55, 0.3);
            color: var(--text-dark);
        }

        .action-btn:hover {
            background: var(--secondary);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(212, 175, 55, 0.3);
        }

        .arabic {
            font-family: 'Amiri', serif;
            font-size: 36px;
            direction: rtl;
            color: var(--text-light);
            line-height: 2;
            text-align: justify;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(212, 175, 55, 0.03);
            border-radius: var(--radius);
            border-right: 3px solid var(--secondary);
            position: relative;
            overflow: hidden;
        }

        .arabic::before {
            content: '﴿';
            position: absolute;
            top: 10px;
            right: 15px;
            font-family: 'Amiri', serif;
            font-size: 40px;
            color: var(--secondary);
            opacity: 0.2;
        }

        .arabic::after {
            content: '﴾';
            position: absolute;
            bottom: 10px;
            left: 15px;
            font-family: 'Amiri', serif;
            font-size: 40px;
            color: var(--secondary);
            opacity: 0.2;
        }

        body.dark-mode .arabic {
            color: var(--text-dark);
            background: rgba(212, 175, 55, 0.05);
        }

        .translation {
            font-size: 17px;
            color: var(--text-light);
            line-height: 1.7;
            margin-bottom: 20px;
            padding: 20px;
            background: linear-gradient(135deg, rgba(26, 95, 42, 0.03), rgba(212, 175, 55, 0.03));
            border-radius: var(--radius);
            border-left: 3px solid var(--primary);
        }

        body.dark-mode .translation {
            color: var(--text-dark);
            background: linear-gradient(135deg, rgba(26, 95, 42, 0.1), rgba(212, 175, 55, 0.05));
        }

        .urdu-translation {
            font-family: 'Amiri', serif;
            font-size: 18px;
            color: var(--text-light);
            line-height: 1.9;
            margin-bottom: 20px;
            padding: 20px;
            background: linear-gradient(135deg, rgba(139, 0, 0, 0.03), rgba(212, 175, 55, 0.03));
            border-radius: var(--radius);
            border-right: 3px solid var(--accent);
            text-align: right;
            direction: rtl;
        }

        body.dark-mode .urdu-translation {
            color: var(--text-dark);
            background: linear-gradient(135deg, rgba(139, 0, 0, 0.1), rgba(212, 175, 55, 0.05));
        }

        .translation-header {
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 10px;
            font-size: 15px;
            text-transform: uppercase;
            letter-spacing: 1px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .translation-header::before {
            content: '';
            width: 20px;
            height: 3px;
            background: var(--secondary);
            border-radius: 2px;
        }

        .urdu-header {
            color: var(--accent);
        }

        .verse-card.playing {
            animation: versePulse 2s infinite;
            border-left-color: var(--primary);
        }

        @keyframes versePulse {
            0%, 100% { box-shadow: 0 0 0 0 rgba(26, 95, 42, 0.4); }
            50% { box-shadow: 0 0 0 10px rgba(26, 95, 42, 0); }
        }

        /* Settings Panel */
        #settings-panel {
            position: fixed;
            top: 80px;
            right: -400px;
            width: 350px;
            background: linear-gradient(135deg, var(--card-light), var(--bg-light));
            height: calc(100vh - 80px);
            padding: 30px;
            box-shadow: var(--shadow-lg);
            z-index: 999;
            transition: right 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            overflow-y: auto;
            border-left: 1px solid var(--border-light);
        }

        body.dark-mode #settings-panel {
            background: linear-gradient(135deg, var(--card-dark), var(--bg-dark));
            border-left-color: var(--border-dark);
        }

        #settings-panel.open {
            right: 0;
        }

        .settings-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--secondary);
        }

        .settings-group {
            margin-bottom: 30px;
            background: rgba(255, 255, 255, 0.5);
            padding: 20px;
            border-radius: var(--radius);
            border: 1px solid var(--border-light);
        }

        body.dark-mode .settings-group {
            background: rgba(255, 255, 255, 0.05);
            border-color: var(--border-dark);
        }

        .settings-title {
            font-size: 20px;
            margin-bottom: 20px;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .settings-title i {
            color: var(--secondary);
        }

        body.dark-mode .settings-title {
            color: var(--text-dark);
        }

        .slider-container {
            margin-bottom: 25px;
        }

        .slider-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
            font-weight: 500;
        }

        .slider-value {
            font-weight: bold;
            color: var(--secondary);
            background: rgba(212, 175, 55, 0.1);
            padding: 3px 10px;
            border-radius: 15px;
            font-size: 14px;
        }

        input[type="range"] {
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: var(--border-light);
            outline: none;
            -webkit-appearance: none;
        }

        body.dark-mode input[type="range"] {
            background: var(--border-dark);
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 22px;
            height: 22px;
            border-radius: 50%;
            background: var(--secondary);
            cursor: pointer;
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.15);
            border: 2px solid var(--card-light);
        }

        body.dark-mode input[type="range"]::-webkit-slider-thumb {
            border-color: var(--card-dark);
        }

        .toggle-switch {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
            padding: 12px;
            background: rgba(255, 255, 255, 0.5);
            border-radius: var(--radius);
            border: 1px solid var(--border-light);
        }

        body.dark-mode .toggle-switch {
            background: rgba(255, 255, 255, 0.05);
            border-color: var(--border-dark);
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 55px;
            height: 28px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--border-light);
            transition: var(--transition);
            border-radius: 34px;
        }

        body.dark-mode .slider {
            background: var(--border-dark);
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: var(--transition);
            border-radius: 50%;
        }

        input:checked + .slider {
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
        }

        input:checked + .slider:before {
            transform: translateX(27px);
        }

        /* Loading Animation */
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100%;
            font-size: 18px;
            color: var(--primary);
            flex-direction: column;
            gap: 20px;
        }

        .spinner {
            border: 4px solid rgba(212, 175, 55, 0.1);
            border-radius: 50%;
            border-top: 4px solid var(--secondary);
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
        }

        /* Translation Selector */
        .translation-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .translation-tab {
            padding: 12px 24px;
            background: linear-gradient(135deg, var(--bg-light), var(--card-light));
            border: 2px solid var(--border-light);
            border-radius: var(--radius);
            cursor: pointer;
            font-size: 15px;
            color: var(--text-light);
            font-weight: 500;
            transition: var(--transition);
            flex: 1;
            text-align: center;
            min-width: 150px;
        }

        body.dark-mode .translation-tab {
            background: linear-gradient(135deg, var(--bg-dark), var(--card-dark));
            border-color: var(--border-dark);
            color: var(--text-dark);
        }

        .translation-tab:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow);
            border-color: var(--primary);
        }

        .translation-tab.active {
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            color: white;
            border-color: var(--primary);
            box-shadow: var(--shadow);
        }

        /* Responsive Design */
        @media (max-width: 1200px) {
            #sidebar {
                width: 280px;
            }
            
            .arabic {
                font-size: 32px;
            }
        }

        @media (max-width: 992px) {
            #sidebar {
                width: 250px;
            }
            
            .arabic {
                font-size: 28px;
            }
            
            .verse-card {
                padding: 20px;
            }
        }

        @media (max-width: 768px) {
            body {
                flex-direction: column;
            }
            
            #sidebar {
                width: 100%;
                height: auto;
                max-height: 40vh;
                margin-top: 70px;
                padding: 15px;
            }
            
            #content {
                margin-top: 0;
                height: auto;
                max-height: 60vh;
                padding: 20px;
            }
            
            .surah-title {
                font-size: 24px;
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            .arabic {
                font-size: 24px;
                padding: 15px;
            }
            
            .audio-controls {
                flex-wrap: wrap;
            }
            
            .verse-number {
                width: 40px;
                height: 40px;
                font-size: 16px;
            }
            
            .action-btn {
                width: 40px;
                height: 40px;
            }
        }

        @media (max-width: 480px) {
            #top-nav {
                padding: 12px 15px;
            }
            
            .logo h2 {
                font-size: 18px;
            }
            
            .arabic {
                font-size: 22px;
            }
            
            .translation-tab {
                min-width: 100%;
            }
        }

        /* Utility Classes */
        .btn {
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: var(--radius);
            cursor: pointer;
            font-size: 15px;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            transition: var(--transition);
            box-shadow: var(--shadow);
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s ease;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg);
        }

        .btn:active {
            transform: translateY(-1px);
        }

        .btn-secondary {
            background: linear-gradient(135deg, var(--secondary), #f7d87c);
            color: #000;
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--primary);
            color: var(--primary);
            box-shadow: none;
        }

        .btn-outline:hover {
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--danger), #e35d6a);
        }

        .btn-icon {
            padding: 10px;
            width: 45px;
            height: 45px;
            justify-content: center;
        }

        .notification {
            position: fixed;
            bottom: 25px;
            right: 25px;
            background: linear-gradient(135deg, var(--success), #34d058);
            color: white;
            padding: 15px 25px;
            border-radius: var(--radius);
            box-shadow: var(--shadow-lg);
            z-index: 10000;
            display: flex;
            align-items: center;
            gap: 15px;
            transform: translateX(400px);
            opacity: 0;
            transition: transform 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55), opacity 0.5s ease;
            max-width: 400px;
        }

        .notification.show {
            transform: translateX(0);
            opacity: 1;
        }

        .notification i {
            font-size: 22px;
        }

        .notification-content {
            flex: 1;
        }

        .notification-title {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .notification-message {
            font-size: 14px;
            opacity: 0.9;
        }

        .notification-close {
            background: none;
            border: none;
            color: white;
            font-size: 18px;
            cursor: pointer;
            padding: 5px;
            opacity: 0.7;
            transition: opacity 0.3s ease;
        }

        .notification-close:hover {
            opacity: 1;
        }

        .bookmark-btn.active {
            color: var(--secondary);
            background: rgba(212, 175, 55, 0.2);
            border-color: var(--secondary);
        }

        .audio-btn.active {
            color: var(--primary);
            background: rgba(26, 95, 42, 0.2);
            border-color: var(--primary);
        }

        .highlight {
            background: linear-gradient(135deg, rgba(212, 175, 55, 0.2), rgba(212, 175, 55, 0.1));
            padding: 3px 8px;
            border-radius: 4px;
            border: 1px solid rgba(212, 175, 55, 0.3);
        }

        /* Floating Action Button */
        .fab {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            color: white;
            border: none;
            cursor: pointer;
            box-shadow: var(--shadow-lg);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            z-index: 100;
            transition: var(--transition);
        }

        .fab:hover {
            transform: scale(1.1) rotate(90deg);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }

        /* Progress Indicator */
        .progress-indicator {
            position: fixed;
            top: 80px;
            left: 0;
            width: 100%;
            height: 3px;
            background: var(--border-light);
            z-index: 999;
        }

        body.dark-mode .progress-indicator {
            background: var(--border-dark);
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--primary-light));
            width: 0%;
            transition: width 0.3s ease;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-light);
        }

        body.dark-mode .empty-state {
            color: var(--text-dark);
        }

        .empty-state i {
            font-size: 64px;
            color: var(--secondary);
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .empty-state h3 {
            font-size: 24px;
            margin-bottom: 15px;
            color: var(--primary);
        }

        body.dark-mode .empty-state h3 {
            color: var(--text-dark);
        }

        .empty-state p {
            font-size: 16px;
            max-width: 500px;
            margin: 0 auto 30px;
            line-height: 1.6;
            opacity: 0.8;
        }

        /* Badge */
        .badge {
            display: inline-block;
            padding: 4px 10px;
            background: linear-gradient(135deg, var(--secondary), #f7d87c);
            color: #000;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Tooltip */
        .tooltip {
            position: relative;
            cursor: help;
        }

        .tooltip::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: var(--primary);
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 13px;
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            z-index: 1000;
            margin-bottom: 10px;
        }

        .tooltip:hover::after {
            opacity: 1;
            visibility: visible;
        }

        /* Quranic Calligraphy Style */
        .quranic-text {
            font-family: 'Amiri', serif;
            position: relative;
        }

        .quranic-text::before,
        .quranic-text::after {
            content: '۞';
            position: absolute;
            color: var(--secondary);
            opacity: 0.3;
            font-size: 40px;
        }

        /* Loading Overlay */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--bg-light);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.5s ease;
        }

        body.dark-mode .loading-overlay {
            background: var(--bg-dark);
        }

        .loading-overlay.hidden {
            opacity: 0;
            pointer-events: none;
        }

        /* Audio Quality Indicator */
        .audio-quality {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 12px;
            color: var(--text-light);
            margin-top: 5px;
        }

        body.dark-mode .audio-quality {
            color: var(--text-dark);
        }

        .quality-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--border-light);
        }

        body.dark-mode .quality-dot {
            background: var(--border-dark);
        }

        .quality-dot.active {
            background: var(--success);
        }

        /* Recent Activity */
        .recent-activity {
            background: rgba(212, 175, 55, 0.05);
            border-radius: var(--radius);
            padding: 15px;
            margin-top: 20px;
            border: 1px solid rgba(212, 175, 55, 0.1);
        }

        body.dark-mode .recent-activity {
            background: rgba(212, 175, 55, 0.08);
            border-color: rgba(212, 175, 55, 0.2);
        }

        .recent-activity h4 {
            margin-bottom: 10px;
            color: var(--primary);
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        body.dark-mode .recent-activity h4 {
            color: var(--text-dark);
        }

        .recent-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px;
            border-radius: 8px;
            margin-bottom: 5px;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .recent-item:hover {
            background: rgba(212, 175, 55, 0.1);
        }

        .recent-item i {
            color: var(--secondary);
            font-size: 14px;
        }

        .recent-item span {
            font-size: 13px;
            flex: 1;
        }

        .recent-item time {
            font-size: 11px;
            color: #666;
            opacity: 0.7;
        }

        body.dark-mode .recent-item time {
            color: #aaa;
        }
    </style>
</head>
<body class="theme-green">
    <!-- Loading Overlay -->
    <div id="loading-overlay" class="loading-overlay">
        <div class="loading">
            <div class="spinner"></div>
            <div>Loading Quran...</div>
        </div>
    </div>

    <!-- Top Navigation -->
    <div id="top-nav">
        <div class="logo">
            <i class="fas fa-quran logo-icon"></i>
            <h2>القرآن الكريم - The Noble Quran</h2>
        </div>
        <div class="nav-controls">
            <div class="theme-selector">
                <button class="theme-btn theme-green active" data-theme="green" title="Green Theme"></button>
                <button class="theme-btn theme-red" data-theme="red" title="Red Theme"></button>
                <button class="theme-btn theme-black" data-theme="black" title="Black Theme"></button>
                <button class="theme-btn theme-blue" data-theme="blue" title="Blue Theme"></button>
            </div>
            <button id="theme-toggle" class="btn btn-outline">
                <i class="fas fa-moon"></i> Dark Mode
            </button>
            <button id="settings-toggle" class="btn">
                <i class="fas fa-cog"></i> Settings
            </button>
        </div>
    </div>

    <!-- Progress Indicator -->
    <div class="progress-indicator">
        <div class="progress-bar" id="progress-bar"></div>
    </div>

    <!-- Sidebar -->
    <div id="sidebar">
        <div class="sidebar-header">
            <h3><i class="fas fa-book-open"></i> Surahs</h3>
            <div id="surah-count" class="badge">114 Total</div>
        </div>
        
        <div class="search-container">
            <i class="fas fa-search search-icon"></i>
            <input type="text" id="search-input" placeholder="Search surahs...">
        </div>
        
        <div class="surah-list-header">
            <h4><i class="fas fa-list"></i> Chapters</h4>
            <div id="filter-controls">
                <button id="sort-by-number" class="btn-outline btn-icon" title="Sort by Number">
                    <i class="fas fa-sort-numeric-down"></i>
                </button>
                <button id="sort-by-name" class="btn-outline btn-icon" title="Sort by Name">
                    <i class="fas fa-sort-alpha-down"></i>
                </button>
            </div>
        </div>
        
        <div id="surah-list">
            <div class="loading">
                <div class="spinner"></div>
                Loading chapters...
            </div>
        </div>

        <!-- Recent Activity -->
        <div class="recent-activity" id="recent-activity" style="display: none;">
            <h4><i class="fas fa-history"></i> Recent Activity</h4>
            <div id="recent-list"></div>
        </div>
    </div>

    <!-- Main Content -->
    <div id="content">
        <!-- Audio Player -->
        <div id="audio-player" class="audio-player">
            <div class="audio-controls">
                <button id="audio-prev" class="btn-outline btn-icon" title="Previous Verse">
                    <i class="fas fa-step-backward"></i>
                </button>
                <button id="audio-play" class="btn btn-icon" title="Play/Pause">
                    <i class="fas fa-play"></i>
                </button>
                <button id="audio-next" class="btn-outline btn-icon" title="Next Verse">
                    <i class="fas fa-step-forward"></i>
                </button>
                <div class="audio-info">
                    <div id="audio-surah-name">Surah Al-Fatihah</div>
                    <div id="audio-ayah-number">Verse 1</div>
                    <div class="audio-quality">
                        <span>Quality:</span>
                        <div class="quality-dot active"></div>
                        <div class="quality-dot active"></div>
                        <div class="quality-dot"></div>
                    </div>
                </div>
                <button id="audio-close" class="btn-danger btn-icon" title="Stop Audio">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="audio-progress-container">
                <div class="audio-progress" id="audio-progress">
                    <div class="audio-progress-bar" id="audio-progress-bar"></div>
                </div>
                <div class="audio-time">
                    <span id="audio-current-time">0:00</span>
                    <span id="audio-duration">0:00</span>
                </div>
            </div>
        </div>
        
        <div class="content-header">
            <h1 id="surah-title" class="surah-title">
                <span>Select a Surah</span>
                <button id="play-full-surah" class="btn btn-secondary">
                    <i class="fas fa-play-circle"></i> Play Full Surah
                </button>
            </h1>
            <div class="surah-meta">
                <span><i class="fas fa-map-marker-alt"></i> <span id="surah-revelation">Select a surah</span></span>
                <span><i class="fas fa-hashtag"></i> <span id="surah-ayahs">0 verses</span></span>
                <span><i class="fas fa-bookmark"></i> <span id="surah-juz">Juz 0</span></span>
            </div>
            
            <!-- Translation Selector -->
            <div class="translation-selector" id="translation-selector" style="display: none;">
                <button class="translation-tab active" data-translation="english">
                    <i class="fas fa-language"></i> English
                </button>
                <button class="translation-tab" data-translation="urdu">
                    <i class="fas fa-font"></i> اردو
                </button>
                <button class="translation-tab" data-translation="both">
                    <i class="fas fa-layer-group"></i> Both
                </button>
            </div>
        </div>
        
        <div id="verses-container">
            <div class="empty-state">
                <i class="fas fa-quran"></i>
                <h3>Welcome to The Noble Quran</h3>
                <p>Select a surah from the sidebar to begin reading. Experience the divine revelation with beautiful recitation and translations.</p>
                <div style="display: flex; gap: 15px; justify-content: center; margin-top: 20px; flex-wrap: wrap;">
                    <div style="text-align: center;">
                        <i class="fas fa-volume-up" style="color: var(--primary); font-size: 24px;"></i>
                        <p style="margin-top: 10px; font-size: 14px;">Click verse numbers<br>for audio</p>
                    </div>
                    <div style="text-align: center;">
                        <i class="fas fa-palette" style="color: var(--secondary); font-size: 24px;"></i>
                        <p style="margin-top: 10px; font-size: 14px;">Change themes<br>for better experience</p>
                    </div>
                    <div style="text-align: center;">
                        <i class="fas fa-bookmark" style="color: var(--accent); font-size: 24px;"></i>
                        <p style="margin-top: 10px; font-size: 14px;">Bookmark verses<br>for later reading</p>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="pagination" style="display: none; margin-top: 40px; text-align: center;">
            <button id="prev-ayah" class="btn btn-outline">
                <i class="fas fa-chevron-left"></i> Previous
            </button>
            <span id="page-info" style="margin: 0 20px; padding: 10px 20px; background: rgba(212, 175, 55, 0.1); border-radius: var(--radius);"></span>
            <button id="next-ayah" class="btn btn-outline">
                Next <i class="fas fa-chevron-right"></i>
            </button>
        </div>
    </div>

    <!-- Settings Panel -->
    <div id="settings-panel">
        <div class="settings-header">
            <h3><i class="fas fa-sliders-h"></i> Settings</h3>
            <button id="close-settings" class="action-btn" title="Close">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <div class="settings-group">
            <h4 class="settings-title"><i class="fas fa-text-height"></i> Text Size</h4>
            
            <div class="slider-container">
                <div class="slider-label">
                    <span>Arabic Text</span>
                    <span id="arabic-size-value" class="slider-value">36px</span>
                </div>
                <input type="range" id="arabic-size" min="24" max="48" value="36" step="2">
            </div>
            
            <div class="slider-container">
                <div class="slider-label">
                    <span>Translation Text</span>
                    <span id="translation-size-value" class="slider-value">17px</span>
                </div>
                <input type="range" id="translation-size" min="14" max="24" value="17" step="1">
            </div>
        </div>
        
        <div class="settings-group">
            <h4 class="settings-title"><i class="fas fa-eye"></i> Display Options</h4>
            
            <div class="toggle-switch">
                <span>Show Translation</span>
                <label class="switch">
                    <input type="checkbox" id="toggle-translation" checked>
                    <span class="slider"></span>
                </label>
            </div>
            
            <div class="toggle-switch">
                <span>Auto Play Audio</span>
                <label class="switch">
                    <input type="checkbox" id="toggle-auto-play" checked>
                    <span class="slider"></span>
                </label>
            </div>
            
            <div class="toggle-switch">
                <span>Night Mode (Auto)</span>
                <label class="switch">
                    <input type="checkbox" id="toggle-night-mode">
                    <span class="slider"></span>
                </label>
            </div>
        </div>
        
        <div class="settings-group">
            <h4 class="settings-title"><i class="fas fa-volume-up"></i> Audio Settings</h4>
            
            <div class="toggle-switch">
                <span>Auto Play Next Verse</span>
                <label class="switch">
                    <input type="checkbox" id="toggle-auto-next" checked>
                    <span class="slider"></span>
                </label>
            </div>
            
            <div class="toggle-switch">
                <span>Show Audio Player</span>
                <label class="switch">
                    <input type="checkbox" id="toggle-audio-player" checked>
                    <span class="slider"></span>
                </label>
            </div>
        </div>
        
        <div class="settings-group">
            <h4 class="settings-title"><i class="fas fa-user-circle"></i> Reciters</h4>
            <select id="reciter-select" class="btn-outline" style="width: 100%; padding: 12px; margin-top: 10px; border-radius: var(--radius);">
                <option value="ar.alafasy">Mishary Alafasy (Default)</option>
                <option value="ar.abdulbasitmurattal">Abdul Basit</option>
                <option value="ar.abdurrahmaansudais">Abdur Rahman Sudais</option>
                <option value="ar.mahermuaiqly">Maher Al Muaiqly</option>
            </select>
            <p style="font-size: 13px; color: #666; margin-top: 10px;">
                <i class="fas fa-info-circle"></i> Some reciters may have limited verse coverage.
            </p>
        </div>
        
        <div class="settings-group">
            <h4 class="settings-title"><i class="fas fa-bookmark"></i> Bookmarks</h4>
            <div id="bookmarks-list"></div>
            <button id="clear-bookmarks" class="btn btn-outline" style="width: 100%; margin-top: 15px;">
                <i class="fas fa-trash"></i> Clear All Bookmarks
            </button>
        </div>
        
        <div class="settings-group">
            <h4 class="settings-title"><i class="fas fa-info-circle"></i> About</h4>
            <p style="font-size: 14px; line-height: 1.6; color: var(--text-light);">
                This digital Quran application uses the AlQuran.cloud API for authentic Quranic text and translations.
                Audio provided by multiple sources for reliability.
                <br><br>
                May Allah accept our efforts and make this beneficial for all who use it.
            </p>
            <div style="margin-top: 15px; display: flex; gap: 10px;">
                <button class="btn-outline" style="flex: 1; padding: 10px; font-size: 13px;" onclick="showNotification('Website refreshed', 'All settings have been refreshed successfully')">
                    <i class="fas fa-redo"></i> Refresh
                </button>
                <button class="btn-outline" style="flex: 1; padding: 10px; font-size: 13px;" onclick="resetSettings()">
                    <i class="fas fa-undo"></i> Reset
                </button>
            </div>
        </div>
    </div>

    <!-- Notification -->
    <div id="notification" class="notification">
        <i class="fas fa-check-circle"></i>
        <div class="notification-content">
            <div class="notification-title" id="notification-title">Success</div>
            <div class="notification-message" id="notification-message">Operation completed successfully</div>
        </div>
        <button class="notification-close" onclick="this.parentElement.classList.remove('show')">
            <i class="fas fa-times"></i>
        </button>
    </div>

    <!-- Floating Action Button -->
    <button id="fab" class="fab" title="Quick Actions">
        <i class="fas fa-bolt"></i>
    </button>

    <script>
        // State management
        const state = {
            currentSurah: null,
            currentSurahData: null,
            currentAyah: 1,
            bookmarks: JSON.parse(localStorage.getItem('quranBookmarks')) || [],
            fontSizeArabic: parseInt(localStorage.getItem('fontSizeArabic')) || 36,
            fontSizeTranslation: parseInt(localStorage.getItem('fontSizeTranslation')) || 17,
            showTranslation: localStorage.getItem('showTranslation') !== 'false',
            showVerseNumbers: localStorage.getItem('showVerseNumbers') !== 'false',
            darkMode: localStorage.getItem('darkMode') === 'true',
            theme: localStorage.getItem('theme') || 'green',
            surahs: [],
            currentTranslation: localStorage.getItem('currentTranslation') || 'english',
            audioEnabled: localStorage.getItem('audioEnabled') !== 'false',
            audioPlayer: null,
            currentAudioVerse: null,
            autoPlayNext: localStorage.getItem('autoPlayNext') !== 'false',
            showAudioPlayer: localStorage.getItem('showAudioPlayer') !== 'false',
            reciter: localStorage.getItem('reciter') || 'ar.alafasy',
            verses: [],
            englishTranslations: [],
            urduTranslations: [],
            recentActivity: JSON.parse(localStorage.getItem('recentActivity')) || []
        };

        // Audio sources for different reciters
        const audioSources = {
            'ar.alafasy': {
                primary: (surah, verse) => `https://everyayah.com/data/mishari_al_afasy/${surah.toString().padStart(3, '0')}${verse.toString().padStart(3, '0')}.mp3`,
                fallback: (surah, verse) => `https://cdn.alquran.cloud/media/audio/ayah/ar.alafasy/${surah}:${verse}`
            },
            'ar.abdulbasitmurattal': {
                primary: (surah, verse) => `https://everyayah.com/data/abdul_basit_murattal/${surah.toString().padStart(3, '0')}${verse.toString().padStart(3, '0')}.mp3`,
                fallback: (surah, verse) => `https://server8.mp3quran.net/basit/Rewayat-Hafs-A-n-Assem/${surah.toString().padStart(3, '0')}${verse.toString().padStart(3, '0')}.mp3`
            },
            'ar.abdurrahmaansudais': {
                primary: (surah, verse) => `https://everyayah.com/data/abdurrahmaan_as-sudais/${surah.toString().padStart(3, '0')}${verse.toString().padStart(3, '0')}.mp3`,
                fallback: (surah, verse) => `https://server8.mp3quran.net/sds/Rewayat-Hafs-A-n-Assem/${surah.toString().padStart(3, '0')}${verse.toString().padStart(3, '0')}.mp3`
            },
            'ar.mahermuaiqly': {
                primary: (surah, verse) => `https://everyayah.com/data/maher_al_muaiqly/${surah.toString().padStart(3, '0')}${verse.toString().padStart(3, '0')}.mp3`,
                fallback: (surah, verse) => `https://server7.mp3quran.net/maher/Rewayat-Hafs-A-n-Assem/${surah.toString().padStart(3, '0')}${verse.toString().padStart(3, '0')}.mp3`
            }
        };

        // DOM Elements
        const elements = {
            loadingOverlay: document.getElementById('loading-overlay'),
            surahList: document.getElementById('surah-list'),
            surahTitle: document.getElementById('surah-title'),
            versesContainer: document.getElementById('verses-container'),
            searchInput: document.getElementById('search-input'),
            themeToggle: document.getElementById('theme-toggle'),
            settingsToggle: document.getElementById('settings-toggle'),
            settingsPanel: document.getElementById('settings-panel'),
            closeSettings: document.getElementById('close-settings'),
            arabicSize: document.getElementById('arabic-size'),
            arabicSizeValue: document.getElementById('arabic-size-value'),
            translationSize: document.getElementById('translation-size'),
            translationSizeValue: document.getElementById('translation-size-value'),
            toggleTranslation: document.getElementById('toggle-translation'),
            toggleAutoPlay: document.getElementById('toggle-auto-play'),
            toggleNightMode: document.getElementById('toggle-night-mode'),
            toggleAutoNext: document.getElementById('toggle-auto-next'),
            toggleAudioPlayer: document.getElementById('toggle-audio-player'),
            bookmarksList: document.getElementById('bookmarks-list'),
            clearBookmarks: document.getElementById('clear-bookmarks'),
            notification: document.getElementById('notification'),
            notificationTitle: document.getElementById('notification-title'),
            notificationMessage: document.getElementById('notification-message'),
            playFullSurah: document.getElementById('play-full-surah'),
            prevAyah: document.getElementById('prev-ayah'),
            nextAyah: document.getElementById('next-ayah'),
            pageInfo: document.getElementById('page-info'),
            pagination: document.getElementById('pagination'),
            sortByNumber: document.getElementById('sort-by-number'),
            sortByName: document.getElementById('sort-by-name'),
            audioPlayer: document.getElementById('audio-player'),
            audioPlay: document.getElementById('audio-play'),
            audioPrev: document.getElementById('audio-prev'),
            audioNext: document.getElementById('audio-next'),
            audioClose: document.getElementById('audio-close'),
            audioProgress: document.getElementById('audio-progress'),
            audioProgressBar: document.getElementById('audio-progress-bar'),
            audioCurrentTime: document.getElementById('audio-current-time'),
            audioDuration: document.getElementById('audio-duration'),
            audioSurahName: document.getElementById('audio-surah-name'),
            audioAyahNumber: document.getElementById('audio-ayah-number'),
            translationSelector: document.getElementById('translation-selector'),
            reciterSelect: document.getElementById('reciter-select'),
            progressBar: document.getElementById('progress-bar'),
            fab: document.getElementById('fab'),
            recentActivity: document.getElementById('recent-activity'),
            recentList: document.getElementById('recent-list'),
            themeButtons: document.querySelectorAll('.theme-btn')
        };

        // Initialize the app
        async function init() {
            // Apply saved theme
            applyTheme(state.theme);
            
            // Load surah list
            await loadSurahList();
            
            // Setup event listeners
            setupEventListeners();
            
            // Apply settings
            applySettings();
            
            // Load bookmarks
            loadBookmarks();
            
            // Load recent activity
            loadRecentActivity();
            
            // Initialize audio
            initializeAudio();
            
            // Set reciter
            elements.reciterSelect.value = state.reciter;
            
            // Hide loading overlay
            setTimeout(() => {
                elements.loadingOverlay.classList.add('hidden');
                setTimeout(() => {
                    elements.loadingOverlay.style.display = 'none';
                }, 500);
            }, 1000);
        }

        // Apply theme
        function applyTheme(theme) {
            // Remove existing theme classes
            document.body.classList.remove('theme-green', 'theme-red', 'theme-black', 'theme-blue');
            
            // Add new theme class
            document.body.classList.add(`theme-${theme}`);
            
            // Update active theme button
            elements.themeButtons.forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.theme === theme) {
                    btn.classList.add('active');
                }
            });
            
            // Save theme
            state.theme = theme;
            localStorage.setItem('theme', theme);
            
            showNotification('Theme Changed', `Applied ${theme.charAt(0).toUpperCase() + theme.slice(1)} theme`);
        }

        // Initialize audio system
        function initializeAudio() {
            state.audioPlayer = new Audio();
            state.audioPlayer.preload = 'metadata';
            
            // Audio event listeners
            state.audioPlayer.addEventListener('timeupdate', updateAudioProgress);
            state.audioPlayer.addEventListener('loadedmetadata', updateAudioDuration);
            state.audioPlayer.addEventListener('ended', handleAudioEnded);
            state.audioPlayer.addEventListener('play', handleAudioPlay);
            state.audioPlayer.addEventListener('pause', handleAudioPause);
            state.audioPlayer.addEventListener('error', handleAudioError);
            
            // Audio control event listeners
            elements.audioPlay.addEventListener('click', toggleAudioPlayback);
            elements.audioPrev.addEventListener('click', playPreviousVerse);
            elements.audioNext.addEventListener('click', playNextVerse);
            elements.audioClose.addEventListener('click', stopAudio);
            elements.audioProgress.addEventListener('click', seekAudio);
            
            // Full surah play
            elements.playFullSurah.addEventListener('click', playFullSurahAudio);
        }

        // Load surah list
        async function loadSurahList() {
            try {
                elements.progressBar.style.width = '30%';
                const response = await fetch('https://api.alquran.cloud/v1/surah');
                const data = await response.json();
                state.surahs = data.data;
                elements.progressBar.style.width = '60%';
                renderSurahList(state.surahs);
                elements.progressBar.style.width = '100%';
                setTimeout(() => elements.progressBar.style.width = '0%', 300);
            } catch (error) {
                console.error('Error loading surah list:', error);
                elements.surahList.innerHTML = '<div style="color: var(--danger); padding: 20px; text-align: center;">Failed to load surahs. Please check your connection.</div>';
                showNotification('Connection Error', 'Failed to load surah list. Please check your internet connection.');
            }
        }

        // Render surah list
        function renderSurahList(surahs) {
            elements.surahList.innerHTML = '';
            
            surahs.forEach(surah => {
                const div = document.createElement('div');
                div.className = 'surah-item';
                div.dataset.id = surah.number;
                
                div.innerHTML = `
                    <div class="surah-info">
                        <div class="surah-name-arabic">${surah.name}</div>
                        <div class="surah-name-english">${surah.englishName} (${surah.englishNameTranslation})</div>
                    </div>
                    <div class="surah-number">${surah.number}</div>
                `;
                
                div.onclick = () => loadSurah(surah.number);
                elements.surahList.appendChild(div);
            });
        }

        // Load a surah
        async function loadSurah(id) {
            elements.progressBar.style.width = '0%';
            state.currentSurah = id;
            state.currentAyah = 1;
            
            // Add to recent activity
            addRecentActivity('surah', id);
            
            // Update active surah in sidebar
            document.querySelectorAll('.surah-item').forEach(item => {
                item.classList.remove('active');
                if (parseInt(item.dataset.id) === id) {
                    item.classList.add('active');
                    item.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            });
            
            elements.versesContainer.innerHTML = `
                <div class="loading">
                    <div class="spinner"></div>
                    Loading surah...
                </div>
            `;
            
            // Show translation selector
            elements.translationSelector.style.display = 'flex';
            
            try {
                elements.progressBar.style.width = '25%';
                
                // Fetch surah details and verses
                const [surahRes, versesRes, englishRes] = await Promise.all([
                    fetch(`https://api.alquran.cloud/v1/surah/${id}`),
                    fetch(`https://api.alquran.cloud/v1/surah/${id}/quran-uthmani`),
                    fetch(`https://api.alquran.cloud/v1/surah/${id}/en.sahih`)
                ]);
                
                elements.progressBar.style.width = '60%';
                
                const surahData = await surahRes.json();
                const versesData = await versesRes.json();
                const englishData = await englishRes.json();
                
                // Try to fetch Urdu translation (optional)
                let urduData = null;
                try {
                    const urduRes = await fetch(`https://api.alquran.cloud/v1/surah/${id}/ur.jalandhry`);
                    if (urduRes.ok) {
                        urduData = await urduRes.json();
                    }
                } catch (error) {
                    console.log('Urdu translation not available');
                }
                
                elements.progressBar.style.width = '85%';
                
                state.currentSurahData = surahData.data;
                state.verses = versesData.data.ayahs;
                state.englishTranslations = englishData.data.ayahs;
                state.urduTranslations = urduData ? urduData.data.ayahs : [];
                
                // Update surah title and metadata
                updateSurahHeader();
                
                // Render verses based on current translation setting
                renderVerses();
                
                // Update audio button
                updateAudioButton();
                
                // Show pagination
                elements.pagination.style.display = 'block';
                updatePagination();
                
                // Scroll to top
                elements.versesContainer.scrollTop = 0;
                
                elements.progressBar.style.width = '100%';
                setTimeout(() => elements.progressBar.style.width = '0%', 300);
                
                showNotification('Surah Loaded', `Loaded ${state.currentSurahData.englishName} successfully`);
                
            } catch (error) {
                console.error('Error loading surah:', error);
                elements.versesContainer.innerHTML = `
                    <div style="color: var(--danger); padding: 50px; text-align: center;">
                        <i class="fas fa-exclamation-triangle" style="font-size: 48px; margin-bottom: 20px;"></i>
                        <h3>Failed to load surah</h3>
                        <p>Please check your connection and try again.</p>
                        <button onclick="loadSurah(${id})" class="btn" style="margin-top: 20px;">
                            <i class="fas fa-redo"></i> Retry
                        </button>
                    </div>
                `;
                showNotification('Error', 'Failed to load surah. Please try again.');
            }
        }

        // Update surah header
        function updateSurahHeader() {
            const surah = state.currentSurahData;
            elements.surahTitle.innerHTML = `
                <span>${surah.number}. ${surah.englishName} (${surah.name})</span>
                <button id="play-full-surah" class="btn btn-secondary">
                    <i class="fas fa-play-circle"></i> Play Full Surah
                </button>
            `;
            
            document.getElementById('surah-revelation').textContent = `${surah.revelationType}`;
            document.getElementById('surah-ayahs').textContent = `${surah.numberOfAyahs} verses`;
            
            // Calculate juz
            const juz = Math.ceil(surah.number / 4);
            document.getElementById('surah-juz').textContent = `Juz ${juz}`;
            
            // Re-attach event listener for full surah play
            document.getElementById('play-full-surah').onclick = playFullSurahAudio;
        }

        // Play verse audio - IMPROVED VERSION
        async function playVerseAudio(verseNumber) {
            if (!state.audioEnabled) {
                showNotification('Audio Disabled', 'Enable audio in settings to play');
                return;
            }
            
            // Add to recent activity
            addRecentActivity('audio', `${state.currentSurah}:${verseNumber}`);
            
            // Stop current audio if playing
            if (!state.audioPlayer.paused) {
                state.audioPlayer.pause();
            }
            
            // Update current audio verse
            state.currentAudioVerse = verseNumber;
            
            // Update audio player display
            const surahName = state.currentSurahData.englishName;
            elements.audioSurahName.textContent = surahName;
            elements.audioAyahNumber.textContent = `Verse ${verseNumber}`;
            
            // Show audio player if enabled
            if (state.showAudioPlayer) {
                elements.audioPlayer.classList.add('active');
            }
            
            // Get audio source based on reciter
            const sources = audioSources[state.reciter];
            if (!sources) {
                showNotification('Error', 'Reciter not supported');
                return;
            }
            
            // Try primary source first
            let audioUrl = sources.primary(state.currentSurah, verseNumber);
            
            try {
                // Pre-test the audio URL
                const testResponse = await fetch(audioUrl, { method: 'HEAD' });
                if (!testResponse.ok) {
                    throw new Error('Primary source failed');
                }
                
                // Set and play audio
                state.audioPlayer.src = audioUrl;
                await state.audioPlayer.play();
                
                // Update UI
                elements.audioPlay.innerHTML = '<i class="fas fa-pause"></i>';
                highlightPlayingVerse(verseNumber);
                showNotification('Playing', `${surahName}, Verse ${verseNumber}`);
                
            } catch (error) {
                console.log('Primary audio source failed, trying fallback...');
                
                // Try fallback source
                audioUrl = sources.fallback(state.currentSurah, verseNumber);
                
                try {
                    state.audioPlayer.src = audioUrl;
                    await state.audioPlayer.play();
                    
                    elements.audioPlay.innerHTML = '<i class="fas fa-pause"></i>';
                    highlightPlayingVerse(verseNumber);
                    showNotification('Playing', `${surahName}, Verse ${verseNumber} (fallback source)`);
                    
                } catch (fallbackError) {
                    console.error('All audio sources failed:', fallbackError);
                    
                    // Try one more fallback - direct from mp3quran.net
                    const directUrl = `https://server8.mp3quran.net/maher/Rewayat-Hafs-A-n-Assem/${state.currentSurah.toString().padStart(3, '0')}${verseNumber.toString().padStart(3, '0')}.mp3`;
                    
                    try {
                        state.audioPlayer.src = directUrl;
                        await state.audioPlayer.play();
                        
                        elements.audioPlay.innerHTML = '<i class="fas fa-pause"></i>';
                        highlightPlayingVerse(verseNumber);
                        showNotification('Playing', `${surahName}, Verse ${verseNumber} (direct source)`);
                        
                    } catch (finalError) {
                        console.error('Final audio attempt failed:', finalError);
                        showNotification('Audio Error', 'Cannot play audio. Please try another reciter or check your connection.');
                        
                        // As last resort, use Text-to-Speech
                        if ('speechSynthesis' in window) {
                            const verseText = state.verses.find(v => v.numberInSurah === verseNumber)?.text;
                            if (verseText) {
                                const utterance = new SpeechSynthesisUtterance(verseText);
                                utterance.lang = 'ar-SA';
                                utterance.rate = 0.8;
                                speechSynthesis.speak(utterance);
                                showNotification('Using TTS', 'Playing with text-to-speech');
                            }
                        }
                    }
                }
            }
        }

        // Highlight playing verse
        function highlightPlayingVerse(verseNumber) {
            document.querySelectorAll('.verse-card').forEach(card => {
                card.classList.remove('playing');
            });
            
            const currentVerse = document.getElementById(`ayah-${verseNumber}`);
            if (currentVerse) {
                currentVerse.classList.add('playing');
                currentVerse.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        }

        // Play full surah audio
        function playFullSurahAudio() {
            if (!state.audioEnabled) {
                showNotification('Audio Disabled', 'Enable audio in settings to play');
                return;
            }
            
            // Add to recent activity
            addRecentActivity('audio', `${state.currentSurah}:full`);
            
            // Start from first verse
            playVerseAudio(1);
        }

        // Play previous verse
        function playPreviousVerse() {
            if (!state.currentAudioVerse || state.currentAudioVerse <= 1) return;
            playVerseAudio(state.currentAudioVerse - 1);
        }

        // Play next verse
        function playNextVerse() {
            if (!state.currentAudioVerse || !state.currentSurahData) return;
            if (state.currentAudioVerse >= state.currentSurahData.numberOfAyahs) return;
            playVerseAudio(state.currentAudioVerse + 1);
        }

        // Toggle audio playback
        function toggleAudioPlayback() {
            if (state.audioPlayer.paused) {
                if (state.audioPlayer.src) {
                    state.audioPlayer.play();
                } else if (state.currentSurah) {
                    playVerseAudio(1);
                }
            } else {
                state.audioPlayer.pause();
            }
        }

        // Stop audio
        function stopAudio() {
            state.audioPlayer.pause();
            state.audioPlayer.currentTime = 0;
            elements.audioPlayer.classList.remove('active');
            document.querySelectorAll('.verse-card').forEach(card => {
                card.classList.remove('playing');
            });
            elements.audioPlay.innerHTML = '<i class="fas fa-play"></i>';
        }

        // Handle audio error
        function handleAudioError(error) {
            console.error('Audio error:', error);
            showNotification('Audio Error', 'Failed to load audio. Trying alternative source...');
            
            // Try to recover by reloading with different source
            if (state.currentAudioVerse) {
                setTimeout(() => {
                    playVerseAudio(state.currentAudioVerse);
                }, 1000);
            }
        }

        // Rest of the functions remain similar to previous version but with updated styles
        // Update audio progress, update audio duration, formatTime, handleAudioEnded, etc.
        // These functions should be copied from the previous version but using the new elements

        // Update audio progress
        function updateAudioProgress() {
            const currentTime = state.audioPlayer.currentTime;
            const duration = state.audioPlayer.duration || 0;
            const progress = (currentTime / duration) * 100 || 0;
            
            elements.audioProgressBar.style.width = `${progress}%`;
            elements.audioCurrentTime.textContent = formatTime(currentTime);
        }

        // Update audio duration
        function updateAudioDuration() {
            const duration = state.audioPlayer.duration || 0;
            elements.audioDuration.textContent = formatTime(duration);
        }

        // Format time
        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins}:${secs < 10 ? '0' : ''}${secs}`;
        }

        // Handle audio ended
        function handleAudioEnded() {
            elements.audioPlay.innerHTML = '<i class="fas fa-play"></i>';
            
            if (state.autoPlayNext && state.currentAudioVerse && state.currentSurahData) {
                if (state.currentAudioVerse < state.currentSurahData.numberOfAyahs) {
                    setTimeout(() => playNextVerse(), 500);
                }
            }
        }

        // Handle audio play
        function handleAudioPlay() {
            elements.audioPlay.innerHTML = '<i class="fas fa-pause"></i>';
        }

        // Handle audio pause
        function handleAudioPause() {
            elements.audioPlay.innerHTML = '<i class="fas fa-play"></i>';
        }

        // Seek audio
        function seekAudio(e) {
            const rect = elements.audioProgress.getBoundingClientRect();
            const pos = (e.clientX - rect.left) / rect.width;
            state.audioPlayer.currentTime = pos * state.audioPlayer.duration;
        }

        // Update audio button
        function updateAudioButton() {
            if (state.audioEnabled) {
                elements.playFullSurah.disabled = false;
                elements.playFullSurah.innerHTML = '<i class="fas fa-play-circle"></i> Play Full Surah';
            } else {
                elements.playFullSurah.disabled = true;
                elements.playFullSurah.innerHTML = '<i class="fas fa-volume-mute"></i> Audio Disabled';
            }
        }

        // Add recent activity
        function addRecentActivity(type, data) {
            const activity = {
                type,
                data,
                timestamp: new Date().toISOString(),
                surahName: state.currentSurahData?.englishName
            };
            
            // Add to beginning of array
            state.recentActivity.unshift(activity);
            
            // Keep only last 10 items
            state.recentActivity = state.recentActivity.slice(0, 10);
            
            // Save to localStorage
            localStorage.setItem('recentActivity', JSON.stringify(state.recentActivity));
            
            // Update UI
            loadRecentActivity();
        }

        // Load recent activity
        function loadRecentActivity() {
            if (state.recentActivity.length === 0) {
                elements.recentActivity.style.display = 'none';
                return;
            }
            
            elements.recentActivity.style.display = 'block';
            elements.recentList.innerHTML = '';
            
            state.recentActivity.forEach(activity => {
                const div = document.createElement('div');
                div.className = 'recent-item';
                
                let icon = 'fas fa-book';
                let text = '';
                
                if (activity.type === 'surah') {
                    icon = 'fas fa-book-open';
                    text = `Opened ${activity.surahName || 'Surah'} ${activity.data}`;
                } else if (activity.type === 'audio') {
                    icon = 'fas fa-volume-up';
                    if (activity.data.includes('full')) {
                        text = `Played ${activity.surahName || 'Surah'} ${activity.data.split(':')[0]}`;
                    } else {
                        const [surah, verse] = activity.data.split(':');
                        text = `Played ${activity.surahName || 'Surah'} ${surah}:${verse}`;
                    }
                }
                
                const time = new Date(activity.timestamp);
                const timeString = time.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
                
                div.innerHTML = `
                    <i class="${icon}"></i>
                    <span>${text}</span>
                    <time>${timeString}</time>
                `;
                
                div.onclick = () => {
                    if (activity.type === 'surah') {
                        loadSurah(parseInt(activity.data));
                    }
                };
                
                elements.recentList.appendChild(div);
            });
        }

        // Show notification
        function showNotification(title, message) {
            elements.notificationTitle.textContent = title;
            elements.notificationMessage.textContent = message;
            elements.notification.classList.add('show');
            
            setTimeout(() => {
                elements.notification.classList.remove('show');
            }, 3000);
        }

        // Reset settings
        function resetSettings() {
            if (confirm('Are you sure you want to reset all settings?')) {
                localStorage.clear();
                location.reload();
            }
        }

        // Apply settings from localStorage
        function applySettings() {
            elements.arabicSize.value = state.fontSizeArabic;
            elements.arabicSizeValue.textContent = `${state.fontSizeArabic}px`;
            
            elements.translationSize.value = state.fontSizeTranslation;
            elements.translationSizeValue.textContent = `${state.fontSizeTranslation}px`;
            
            elements.toggleTranslation.checked = state.showTranslation;
            elements.toggleAutoPlay.checked = state.audioEnabled;
            elements.toggleNightMode.checked = localStorage.getItem('darkModeAuto') === 'true';
            elements.toggleAutoNext.checked = state.autoPlayNext;
            elements.toggleAudioPlayer.checked = state.showAudioPlayer;
            
            // Apply dark mode if enabled
            if (state.darkMode) {
                document.body.classList.add('dark-mode');
                elements.themeToggle.innerHTML = '<i class="fas fa-sun"></i> Light Mode';
            }
        }

        // Setup event listeners
        function setupEventListeners() {
            // Theme buttons
            elements.themeButtons.forEach(btn => {
                btn.addEventListener('click', () => applyTheme(btn.dataset.theme));
            });
            
            // Theme toggle
            elements.themeToggle.addEventListener('click', () => {
                state.darkMode = !state.darkMode;
                document.body.classList.toggle('dark-mode');
                
                if (state.darkMode) {
                    elements.themeToggle.innerHTML = '<i class="fas fa-sun"></i> Light Mode';
                } else {
                    elements.themeToggle.innerHTML = '<i class="fas fa-moon"></i> Dark Mode';
                }
                
                localStorage.setItem('darkMode', state.darkMode);
                showNotification('Mode Changed', state.darkMode ? 'Dark mode enabled' : 'Light mode enabled');
            });
            
            // Settings panel
            elements.settingsToggle.addEventListener('click', () => elements.settingsPanel.classList.add('open'));
            elements.closeSettings.addEventListener('click', () => elements.settingsPanel.classList.remove('open'));
            
            // Font size controls
            elements.arabicSize.addEventListener('input', function() {
                state.fontSizeArabic = parseInt(this.value);
                localStorage.setItem('fontSizeArabic', state.fontSizeArabic);
                elements.arabicSizeValue.textContent = `${state.fontSizeArabic}px`;
                updateFontSizes();
            });
            
            elements.translationSize.addEventListener('input', function() {
                state.fontSizeTranslation = parseInt(this.value);
                localStorage.setItem('fontSizeTranslation', state.fontSizeTranslation);
                elements.translationSizeValue.textContent = `${state.fontSizeTranslation}px`;
                updateFontSizes();
            });
            
            // Toggle controls
            elements.toggleTranslation.addEventListener('change', function() {
                state.showTranslation = this.checked;
                localStorage.setItem('showTranslation', state.showTranslation);
                if (state.currentSurah) {
                    renderVerses();
                }
            });
            
            elements.toggleAutoPlay.addEventListener('change', function() {
                state.audioEnabled = this.checked;
                localStorage.setItem('audioEnabled', state.audioEnabled);
                updateAudioButton();
            });
            
            elements.toggleAutoNext.addEventListener('change', function() {
                state.autoPlayNext = this.checked;
                localStorage.setItem('autoPlayNext', state.autoPlayNext);
            });
            
            elements.toggleAudioPlayer.addEventListener('change', function() {
                state.showAudioPlayer = this.checked;
                localStorage.setItem('showAudioPlayer', state.showAudioPlayer);
            });
            
            elements.toggleNightMode.addEventListener('change', function() {
                localStorage.setItem('darkModeAuto', this.checked);
                if (this.checked) checkNightMode();
            });
            
            // Reciter select
            elements.reciterSelect.addEventListener('change', function() {
                state.reciter = this.value;
                localStorage.setItem('reciter', state.reciter);
                showNotification('Reciter Changed', `Changed to ${this.options[this.selectedIndex].text}`);
                
                if (state.currentAudioVerse && !state.audioPlayer.paused) {
                    playVerseAudio(state.currentAudioVerse);
                }
            });
            
            // Search functionality
            elements.searchInput.addEventListener('input', function() {
                const searchTerm = this.value.toLowerCase();
                const filtered = state.surahs.filter(surah => 
                    surah.englishName.toLowerCase().includes(searchTerm) ||
                    surah.name.toLowerCase().includes(searchTerm) ||
                    surah.englishNameTranslation.toLowerCase().includes(searchTerm)
                );
                renderSurahList(filtered);
            });
            
            // FAB click
            elements.fab.addEventListener('click', () => {
                if (state.currentSurah) {
                    playVerseAudio(1);
                } else {
                    showNotification('Quick Action', 'Select a surah first');
                }
            });
            
            // Close settings when clicking outside
            document.addEventListener('click', (e) => {
                if (!elements.settingsPanel.contains(e.target) && 
                    !elements.settingsToggle.contains(e.target) &&
                    elements.settingsPanel.classList.contains('open')) {
                    elements.settingsPanel.classList.remove('open');
                }
            });
        }

        // Initialize on DOM load
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
