<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Al-Quran | Modern Reader</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&family=Amiri&display=swap" rel="stylesheet">
    
    <style>
        :root { --primary: #059669; }
        body { font-family: 'Inter', sans-serif; }
        .arabic-text { font-family: 'Amiri', serif; direction: rtl; }
        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #e2e8f0; border-radius: 10px; }
        
        #toast {
            visibility: hidden; min-width: 200px; background: #059669; color: white;
            text-align: center; border-radius: 12px; padding: 12px; position: fixed;
            z-index: 100; bottom: 30px; left: 50%; transform: translateX(-50%);
        }
        #toast.show { visibility: visible; animation: fadein 0.5s, fadeout 0.5s 2.5s; }
        @keyframes fadein { from {bottom: 0; opacity: 0;} to {bottom: 30px; opacity: 1;} }
        @keyframes fadeout { from {bottom: 30px; opacity: 1;} to {bottom: 0; opacity: 0;} }
    </style>
</head>
<body class="bg-slate-50 text-slate-900">

    <div id="toast">Copied to clipboard!</div>

    <div class="flex h-screen overflow-hidden">
        <aside class="w-80 bg-white border-r border-slate-200 flex flex-col hidden lg:flex">
            <div class="p-6 border-b border-slate-100">
                <h1 class="text-xl font-bold bg-gradient-to-r from-emerald-600 to-teal-500 bg-clip-text text-transparent mb-4">Al-Quran</h1>
                
                <div class="relative mb-4">
                    <input type="text" id="surahSearch" onkeyup="filterSurahs()" placeholder="Search Surah..." 
                        class="w-full pl-4 pr-4 py-2 bg-slate-100 border-none rounded-xl text-sm focus:ring-2 focus:ring-emerald-500 outline-none">
                </div>

                <div class="bg-slate-50 p-3 rounded-xl space-y-3">
                    <div>
                        <label class="text-[10px] font-bold text-slate-400 uppercase">Text Size</label>
                        <input type="range" id="fontSize" min="24" max="60" value="32" oninput="updateFontSize(this.value)" class="w-full h-1 accent-emerald-600">
                    </div>
                    <div>
                        <label class="text-[10px] font-bold text-slate-400 uppercase">Reciter</label>
                        <select id="reciterSelect" onchange="changeReciter(this.value)" class="w-full text-xs bg-transparent border-none outline-none text-slate-600">
                            <option value="ar.alafasy">Mishary Rashid Alafasy</option>
                            <option value="ar.abdurrahmansudais">Abdurrahman Al-Sudais</option>
                            <option value="ar.minshawi">Mohamed Siddiq El-Minshawi</option>
                        </select>
                    </div>
                </div>
            </div>

            <ul id="surah-list" class="flex-1 overflow-y-auto p-4 space-y-2 custom-scrollbar">
                <div class="text-center py-10 text-slate-400 animate-pulse text-sm">Loading Surahs...</div>
            </ul>
        </aside>

        <main class="flex-1 overflow-y-auto relative flex flex-col" id="main-content">
            <div class="sticky top-0 z-10 bg-white/80 backdrop-blur-md border-b border-slate-200 p-4 px-8 flex items-center justify-between">
                <div>
                    <h2 id="current-surah-title" class="text-lg font-semibold text-slate-800 tracking-tight">Select a Surah</h2>
                    <p id="surah-subtitle" class="text-xs text-slate-400 uppercase font-medium">Ready to read</p>
                </div>
                <div id="progress-container" class="absolute bottom-0 left-0 h-[2px] bg-emerald-500 transition-all w-0"></div>
            </div>

            <div id="quran-container" class="max-w-4xl mx-auto py-12 px-6 space-y-12 w-full transition-opacity duration-300">
                <div class="text-center py-20">
                    <p class="text-slate-400">Please select a chapter from the sidebar to begin reading.</p>
                </div>
            </div>
        </main>
    </div>

    <script>
        let allSurahs = [];
        let currentSettings = {
            fontSize: localStorage.getItem('quranFontSize') || '32',
            reciter: localStorage.getItem('quranReciter') || 'ar.alafasy'
        };

        // Initialize App
        async function init() {
            document.getElementById('fontSize').value = currentSettings.fontSize;
            document.getElementById('reciterSelect').value = currentSettings.reciter;
            await loadSidebar();
            
            const saved = localStorage.getItem('lastReadSurah');
            if (saved) handleSurahClick(saved);
        }

        async function loadSidebar() {
            try {
                const res = await fetch('https://api.alquran.cloud/v1/surah');
                const data = await res.json();
                allSurahs = data.data;
                renderList(allSurahs);
            } catch (e) { console.error("Sidebar error", e); }
        }

        function renderList(list) {
            const container = document.getElementById('surah-list');
            container.innerHTML = list.map(s => `
                <li>
                    <button onclick="handleSurahClick(${s.number})" id="btn-${s.number}" 
                        class="surah-btn w-full text-left px-4 py-3 rounded-xl hover:bg-emerald-50 transition-all flex justify-between items-center group">
                        <div class="flex items-center gap-3">
                            <span class="text-xs font-bold text-slate-300 w-6">${s.number}</span>
                            <div>
                                <p class="text-sm font-semibold text-slate-700 group-hover:text-emerald-700">${s.englishName}</p>
                            </div>
                        </div>
                        <span class="arabic-text text-lg text-slate-400 group-hover:text-emerald-600">${s.name}</span>
                    </button>
                </li>
            `).join('');
        }

        function filterSurahs() {
            const query = document.getElementById('surahSearch').value.toLowerCase();
            const filtered = allSurahs.filter(s => s.englishName.toLowerCase().includes(query) || s.number == query);
            renderList(filtered);
        }

        function handleSurahClick(num) {
            localStorage.setItem('lastReadSurah', num);
            document.querySelectorAll('.surah-btn').forEach(b => b.classList.remove('bg-emerald-100', 'text-emerald-700'));
            const active = document.getElementById(`btn-${num}`);
            if(active) active.classList.add('bg-emerald-100', 'text-emerald-700');
            fetchSurah(num);
        }

        async function fetchSurah(num) {
            const container = document.getElementById('quran-container');
            container.style.opacity = '0.4';
            
            try {
                const res = await fetch(`https://api.alquran.cloud/v1/surah/${num}/editions/quran-uthmani,en.sahih,${currentSettings.reciter}`);
                const data = await res.json();
                
                const arabic = data.data[0];
                const english = data.data[1];
                const audio = data.data[2];

                document.getElementById('current-surah-title').innerText = arabic.englishName;
                document.getElementById('surah-subtitle').innerText = `${arabic.revelationType} â€¢ ${arabic.numberOfAyahs} Ayahs`;

                container.innerHTML = arabic.ayahs.map((ayah, i) => `
                    <div class="group relative py-10 border-b border-slate-100 transition-all">
                        <div class="flex justify-between items-start mb-6">
                            <span class="text-emerald-500 font-mono text-xs p-2 bg-emerald-50 rounded-lg">Verse ${ayah.numberInSurah}</span>
                            <p class="arabic-text text-right text-slate-800 w-full" style="font-size: ${currentSettings.fontSize}px; line-height: 1.8;">
                                ${ayah.text}
                            </p>
                        </div>
                        <div class="flex gap-6 items-start max-w-2xl">
                            <div class="flex flex-col gap-2">
                                <button onclick="playVerse(this, '${audio.ayahs[i].audio}')" class="w-10 h-10 rounded-full bg-slate-100 flex items-center justify-center hover:bg-emerald-600 hover:text-white transition-all">â–¶</button>
                                <button onclick="copyAyah(\`${ayah.text}\`, \`${english.ayahs[i].text}\`, ${num}, ${ayah.numberInSurah})" class="w-10 h-10 rounded-full bg-slate-100 flex items-center justify-center hover:bg-blue-600 hover:text-white transition-all">ðŸ“‹</button>
                            </div>
                            <p class="text-lg text-slate-500 font-light leading-relaxed">${english.ayahs[i].text}</p>
                        </div>
                    </div>
                `).join('');
                container.style.opacity = '1';
                document.getElementById('main-content').scrollTop = 0;
            } catch (e) { console.error(e); }
        }

        function playVerse(btn, url) {
            const audio = new Audio(url);
            btn.innerText = 'â³';
            audio.play();
            audio.onended = () => btn.innerText = 'â–¶';
        }

        function copyAyah(ar, en, s, a) {
            const text = `${ar}\n\n${en}\n\n[Quran ${s}:${a}]`;
            navigator.clipboard.writeText(text);
            const t = document.getElementById("toast");
            t.className = "show";
            setTimeout(() => { t.className = ""; }, 3000);
        }

        function updateFontSize(s) {
            currentSettings.fontSize = s;
            localStorage.setItem('quranFontSize', s);
            document.querySelectorAll('.arabic-text').forEach(el => {
                el.style.fontSize = s + 'px';
            });
        }

        function changeReciter(r) {
            currentSettings.reciter = r;
            localStorage.setItem('quranReciter', r);
            const saved = localStorage.getItem('lastReadSurah');
            if(saved) fetchSurah(saved);
        }

        // Scroll Progress
        document.getElementById('main-content').onscroll = function() {
            const el = document.getElementById('main-content');
            const scrolled = (el.scrollTop / (el.scrollHeight - el.clientHeight)) * 100;
            document.getElementById("progress-container").style.width = scrolled + "%";
        };

        init();
    </script>
</body>
</html>
